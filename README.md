# CMake Test Generating Routine (cmake-test-generator)

The [CMake](https://cmake.org) routine `cmake-test-generator` defined as a function `CreateTests` generates ready-to-run tests for CMake building environment. The generator creates tests templates and then creates corresponding build targets and test cases.

## Usage

In general, after build it is enough to run standard `make test` command to perform tests of the project treated by `cmake-test-generator`. The most common case of usage looks like following:

```cmake
# It is recommended to use git submodule mechanism as most flexible integration method
include(cmake-test-generator/test-generator.cmake) 

CreateTests(TEST_LIST
    implementation      # generates tests/implementation-test.cpp,
                        # implementation-test build target and
                        # "implementation" test case
    transitions         # generates tests/transitions-test.cpp 
                        # transitions-test build target and
                        # "transitions" test case
    )
```

The `CreateTests` function invocation looks like following:

```
CreateTests(TEST_LIST <tests>
    TEST_DIR directory
    TEST_TEMPLATE_NAME template-file
    TEST_LIBRARY library-target-name
)
```

`TEST_LIST` is the only mandatory parameter of such invocation. It consists of test names formatted as common autogenerated CMake string list. `CreateTests` iterates over this list and then it scans directory mentioned in `TEST_DIR` parameter (`${CMAKE_CURRENT_SOURCE_DIR}/tests` by default) for C++ files named `<test-name>-test.cpp`. If there is no file for the existing test name in `TEST_DIR`, then the template file name is extracted from `TEST_TEMPLATE_NAME` parameter (`${TEST_GENERATOR_ROOT_DIR}/config/test.cpp.in` by default). Now `CreateTests` invokes `ConfigureFile` macro to create the ready-to-compile C++ file for test. The core test template file included with routine looks like:

```c++
#cmakedefine @CREATE_TESTS_TEST_LIBRARY@
#ifdef @CREATE_TESTS_TEST_LIBRARY@
    #include "@CREATE_TESTS_TEST_LIBRARY@.h"
#endif
/*
 * The preprocessing condition prevents including nonexistent header file
 * wnen TEST_LIBRARY is undefined
*/
int main(int argc, char** args)
{
    return 0;
}
```

If `TEST_LIBRARY` parameter is specified, then the header name mentioned as value will be included into generated C++ file. Also `target_link_libraries` will be invoked to link library with the specified name to the test.

## Customizing

`cmake-test-generator` uses set of CMake variables to determine its behaviour. Here the list of these variables is given:

|**Variable**|**Default value**|**Effect**|
|------------|-----------------|----------|
|`TEST_GENERATOR_ROOT_DIR`|`${PROJECT_SOURCE_DIR}/cmake-test-generator`|The root dir from where the routine extracts templates and internally used file names by default|
|`${<test-name>}_LIBRARIES`|Undefined|A set of libraries to be linked with the specific test. They will be added to `target_link_libraries` invocation|
|`${<test-name>}_INCLUDE_DIRS`|Undefined|Include directories required for specific test. If this variable set, `target_include_directories` will be invoked to add the mentioned directories into private include paths list for corresponding build target of the test|

